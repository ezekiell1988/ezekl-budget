<!-- =====================================================
     ADDRESS PAGE - RESPONSIVE DUAL TEMPLATE
     
     Template condicional según plataforma:
     - Mobile: Ionic Maps y componentes
     - Desktop: Color-Admin panels y controles
     ===================================================== -->

<!-- ========== VERSIÓN MÓVIL (IONIC) ========== -->
@if (isMobile()) {
<ion-content [fullscreen]="true" class="ion-no-padding">
  <!-- Contenedor del mapa - SIEMPRE VISIBLE -->
  <div #mapContainer class="map-container-mobile"></div>

  <!-- Skeleton loader mientras carga el mapa -->
  @if (!isMapReady) {
  <div class="skeleton-overlay">
    <ion-skeleton-text [animated]="true" class="skeleton-map"></ion-skeleton-text>
  </div>
  }

  <!-- Loading spinner -->
  @if (isLoadingLocation && isMapReady) {
  <div
    style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: rgba(255, 255, 255, 0.9); z-index: 1000;">
    <ion-spinner name="crescent"></ion-spinner>
    <p class="ion-margin-top ion-text-center" style="font-size: 14px; color: var(--ion-color-medium);">
      Obteniendo ubicación...
    </p>
  </div>
  }



  <!-- Barra de búsqueda -->
  @if (isMapReady) {
  <div style="position: absolute; top: 16px; left: 16px; right: 80px; z-index: 1000;">
    <ion-searchbar #searchbar placeholder="Buscar dirección..." animated="true" mode="ios">
    </ion-searchbar>
  </div>
  }

  <!-- Controles sobre el mapa -->
  @if (isMapReady) {
  <div style="position: absolute; top: 16px; right: 16px; z-index: 999;">
    <ion-button fill="solid" shape="round" size="large" color="light" (click)="centerOnCurrentLocation()"
      [disabled]="isLoadingLocation">
      <ion-icon slot="icon-only" name="locate" color="primary"></ion-icon>
    </ion-button>
  </div>
  }

  <!-- Botón FAB con opciones -->
  @if (isMapReady) {
  <ion-fab slot="fixed" vertical="bottom" horizontal="start" class="address-fab">
    <ion-fab-button color="theme" [disabled]="isSavingAddress">
      <ion-icon name="chevron-up-circle"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button color="theme" (click)="confirmLocation()" [disabled]="!selectedLocation || isSavingAddress">
        <ion-icon name="checkmark"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="theme" (click)="centerOnCurrentLocation()" [disabled]="isLoadingLocation || isSavingAddress">
        <ion-icon name="locate"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
  }
</ion-content>
}

<!-- ========== VERSIÓN DESKTOP (COLOR-ADMIN) ========== -->
@if (isDesktop()) {
<!-- Mapa a pantalla completa -->
<div class="position-absolute w-100 h-100 top-0 start-0 bottom-0 end-0">
  <div #mapContainer class="w-100 h-100"></div>

  <!-- Skeleton loader mientras carga el mapa -->
  @if (!isMapReady) {
  <div class="skeleton-overlay-desktop">
    <div class="d-flex justify-content-center align-items-center h-100">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  </div>
  }

  <!-- Loading spinner -->
  @if (isLoadingLocation && isMapReady) {
  <div class="position-absolute top-0 start-0 end-0 bottom-0 d-flex flex-column justify-content-center align-items-center bg-dark bg-opacity-75" style="z-index: 1000;">
    <div class="spinner-border text-light" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-light">Obteniendo ubicación...</p>
  </div>
  }

  <!-- Saving address spinner -->
  @if (isSavingAddress && isMapReady) {
  <div class="position-absolute top-0 start-0 end-0 bottom-0 d-flex flex-column justify-content-center align-items-center bg-dark bg-opacity-75" style="z-index: 1001;">
    <div class="spinner-border text-success" role="status">
      <span class="visually-hidden">Guardando...</span>
    </div>
    <p class="mt-3 text-success">Guardando dirección...</p>
  </div>
  }
</div>

<!-- Controles sobre el mapa -->
<div class="app-content-padding position-relative" data-bs-theme="dark">
  <!-- Controles de búsqueda -->
  <div class="row mb-3">
    <div class="col-lg-8">
      <div class="input-group input-group-lg">
        <span class="input-group-text bg-dark border-secondary">
          <i class="fa fa-search text-white"></i>
        </span>
        <input 
          #searchInput 
          type="text" 
          class="form-control form-control-lg bg-dark border-secondary text-white" 
          placeholder="Buscar dirección..."
        >
      </div>
    </div>
    <div class="col-lg-2">
      <button 
        class="btn btn-primary btn-lg w-100" 
        (click)="centerOnCurrentLocation()"
        [disabled]="isLoadingLocation || isSavingAddress">
        <i class="fa fa-crosshairs me-2"></i>
        Mi ubicación
      </button>
    </div>
    <div class="col-lg-2">
      <button 
        class="btn btn-success btn-lg w-100" 
        (click)="confirmLocation()"
        [disabled]="!selectedLocation || isSavingAddress">
        <i class="fa fa-check me-2"></i>
        {{ isSavingAddress ? 'Guardando...' : 'Confirmar' }}
      </button>
    </div>
  </div>
</div>
}
