<!-- =====================================================
     SIDEBAR COMPONENT - RESPONSIVE
     
     Mobile: Ionic ion-menu
     Desktop: Color-Admin Sidebar completo
     ===================================================== -->

<!-- ========== VERSIÓN MOBILE ========== -->
@if (isMobile() && isAuthenticated()) {
<ion-menu contentId="main-content" menuId="main-menu" type="overlay">
    <ion-header>
        <ion-toolbar color="theme">
            <ion-title>{{ appSettings.nameCompany }}</ion-title>
            <ion-buttons slot="end">
                <ion-button (click)="closeMenu()">
                    <ion-icon name="close-outline"></ion-icon>
                </ion-button>
            </ion-buttons>
        </ion-toolbar>
    </ion-header>
    <ion-content>
        <!-- Perfil de Usuario -->
        @if (currentUser) {
        <div class="user-profile-mobile">
            <div class="profile-avatar">
                <img src="assets/img/user.png" alt="Usuario" />
            </div>
            <div class="profile-info">
                <h3>{{ currentUser?.nameLogin || 'Usuario' }}</h3>
                <p>{{ currentUser?.emailLogin || 'Sin email' }}</p>
            </div>
        </div>
        }

        <ion-list lines="full" class="ion-no-padding">
            <!-- Template recursivo para menús -->
            <ng-template #mobileMenuTemplate let-items="items" let-level="level">
                @for (item of items; track item.title) {
                    @if (item.submenu) {
                        <!-- Item con submenú - expandible -->
                        <ion-item button (click)="toggleMobileSubmenu(item)" lines="none" [detail]="false" 
                            [class]="'menu-level-' + level"
                            [style.padding-left.px]="level > 0 ? level * 16 : null">
                            @if (item.iconMobile) {
                            <ion-icon [name]="item.iconMobile" slot="start"></ion-icon>
                            }
                            <ion-label>{{ item.title }}</ion-label>
                            <ion-icon [name]="item.expanded ? 'chevron-down-outline' : 'chevron-forward-outline'" 
                                slot="end"></ion-icon>
                        </ion-item>
                        
                        <!-- Submenú colapsable -->
                        @if (item.expanded) {
                            <div class="submenu-container">
                                <ng-container *ngTemplateOutlet="mobileMenuTemplate; context: {items: item.submenu, level: level + 1}">
                                </ng-container>
                            </div>
                        }
                    } @else {
                        <!-- Item sin submenú - navegable -->
                        <ion-menu-toggle auto-hide="true">
                            <ion-item 
                                [routerLink]="item.url" 
                                routerLinkActive="selected" 
                                [detail]="false"
                                lines="none"
                                [class]="'menu-level-' + level"
                                [style.padding-left.px]="level > 0 ? level * 16 : null"
                                #rla="routerLinkActive">
                                @if (item.iconMobile) {
                                <ion-icon [name]="item.iconMobile" slot="start"></ion-icon>
                                }
                                <ion-label>{{ item.title }}</ion-label>
                            </ion-item>
                        </ion-menu-toggle>
                    }
                }
            </ng-template>
            
            <!-- Renderizar el menú principal -->
            <ng-container *ngTemplateOutlet="mobileMenuTemplate; context: {items: menus, level: 0}"></ng-container>
        </ion-list>
    </ion-content>

    <ion-footer>
        <ion-item lines="none" button (click)="logout()" [detail]="false">
            <ion-icon name="log-out-outline" slot="start"></ion-icon>
            <ion-label>Cerrar Sesión</ion-label>
        </ion-item>
    </ion-footer>
</ion-menu>
}

<!-- ========== VERSIÓN DESKTOP ========== -->
@if (isDesktop()) {
<!-- BEGIN #sidebar -->
<div id="sidebar" class="app-sidebar" [attr.data-bs-theme]="appSettings.appSidebarLight ? '' : 'dark'" [ngClass]="{ 
  	'app-sidebar-transparent': this.appSidebarTransparent,
  	'app-sidebar-grid': this.appSidebarGrid
  }">
    <!-- BEGIN scrollbar -->
    <ng-scrollbar class="app-sidebar-content" [ngClass]="{ 'h-100': appSettings.appSidebarFixed }" #sidebarScrollbar
        (scroll)="onScroll($event)">
        <!-- BEGIN menu -->
        <div class="menu">
            @if (!appSettings.appSidebarSearch && currentUser) {
            <div class="menu-item menu-profile">
                <a href="javascript:;" class="menu-profile-link" (click)="toggleNavProfile($event)">
                    <div class="menu-profile-cover with-shadow"></div>
                    <div class="menu-profile-image">
                        <img src="assets/img/user.png" alt="Usuario" />
                    </div>
                    <div class="menu-profile-info">
                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                                {{ currentUser?.nameLogin || 'Usuario' }}
                            </div>
                            <div class="menu-caret ms-auto"></div>
                        </div>
                        <small>{{ currentUser?.emailLogin || 'Sin email' }}</small>
                    </div>
                </a>
            </div>
            }
            @if (!appSettings.appSidebarSearch && currentUser) {
            <div id="appSidebarProfileMenu" class="collapse">
                <div class="menu-item pt-5px">
                    <a href="javascript:;" class="menu-link">
                        <div class="menu-icon"><i class="fa fa-cog"></i></div>
                        <div class="menu-text">Configuración</div>
                    </a>
                </div>
                <div class="menu-item">
                    <a href="javascript:;" class="menu-link">
                        <div class="menu-icon"><i class="fa fa-pencil-alt"></i></div>
                        <div class="menu-text"> Enviar Comentarios</div>
                    </a>
                </div>
                <div class="menu-item">
                    <a href="javascript:;" class="menu-link">
                        <div class="menu-icon"><i class="fa fa-question-circle"></i></div>
                        <div class="menu-text"> Ayuda</div>
                    </a>
                </div>
                <div class="menu-divider m-0"></div>
                <div class="menu-item pb-5px">
                    <a href="javascript:;" class="menu-link" (click)="logout()">
                        <div class="menu-icon"><i class="fa fa-sign-out-alt"></i></div>
                        <div class="menu-text"> Cerrar Sesión</div>
                    </a>
                </div>
            </div>
            }

            @if (appSettings.appSidebarSearch) {
            <div class="menu-search mb-n3">
                <input type="text" class="form-control" placeholder="Filtro del menú lateral..."
                    (keyup)="appSidebarSearch($event)" />
            </div>
            }
            <div class="menu-header">Navegación</div>

            <!-- render sidebarMenuNav -->
            <ng-template #sidebarMenuNav let-menu="menu">
                @if (menu.img) {
                <div class="menu-icon-img"><img src="{{ menu.img }}" /></div>
                }
                @if (menu.icon) {
                <div class="menu-icon"><i class="{{ menu.icon }}"></i></div>
                }
                @if (menu.title) {
                <div class="menu-text">
                    {{ menu.title }}
                    @if (menu.label) {
                    <span class="menu-label">{{ menu.label }}</span>
                    }
                </div>
                }
                @if (menu.badge) {
                <div class="menu-badge">{{ menu.badge }}</div>
                }
                @if (menu.caret) {
                <div class="menu-caret"></div>
                }
            </ng-template>

            <!-- render sidebarSubMenuNav -->
            <ng-template #sidebarSubMenuNav let-menu="menu">
                @if (menu.title) {
                <div class="menu-text">
                    {{ menu.title }}
                    @if (menu.highlight) {
                    <i class="fa fa-paper-plane text-theme ms-5px"></i>
                    }
                </div>
                }
                @if (menu.caret) {
                <div class="menu-caret"></div>
                }
            </ng-template>

            <!-- sidebar menu -->
            @for (menu of menus; track menu) {
            <div class="menu-item" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
                [ngClass]="{ 'expand': menu.state == 'expand', 'has-sub': menu.submenu, 'd-none': menu.hide }"
                #rla="routerLinkActive">
                @if (menu.submenu) {
                <a class="menu-link" (mouseenter)="showAppSidebarFloatSubMenu(menu.submenu, $event)"
                    (mouseleave)="hideAppSidebarFloatSubMenu()">
                    <ng-container *ngTemplateOutlet="sidebarMenuNav; context: {menu: menu}"></ng-container>
                </a>
                }
                @if (!menu.submenu) {
                <a class="menu-link" [routerLink]="menu.url">
                    <ng-container *ngTemplateOutlet="sidebarMenuNav; context: {menu: menu}"></ng-container>
                </a>
                }

                <!-- submenu lvl 1 -->
                @if (menu.submenu) {
                <div class="menu-submenu"
                    [style.display]="(menu.state == 'expand' && !appSettings.appSidebarMinified) ? 'block' : (menu.state == 'collapse') ? 'none' : ''">
                    @for (menu1 of menu.submenu; track menu1) {
                    <div class="menu-item" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
                        [ngClass]="{ 'expand': menu1.state == 'expand', 'closed': menu1.state == 'collapsed', 'has-sub': menu1.submenu, 'd-none': menu1.hide }"
                        #rla1="routerLinkActive">
                        @if (menu1.submenu) {
                        <a class="menu-link"
                            (click)="(menu1.submenu) ? expandCollapseSubmenu(menu1, menu.submenu, rla1) : ''">
                            <ng-template *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu1}"></ng-template>
                        </a>
                        }
                        @if (!menu1.submenu) {
                        <a class="menu-link" [routerLink]="menu1.url">
                            <ng-template *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu1}"></ng-template>
                        </a>
                        }

                        <!-- submenu lvl 2 -->
                        @if (menu1.submenu) {
                        <div class="menu-submenu"
                            [style.display]="(menu1.state == 'expand' && !appSettings.appSidebarMinified) ? 'block' : (menu1.state == 'collapse') ? 'none' : ''">
                            @for (menu2 of menu1.submenu; track menu2) {
                            <div class="menu-item" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
                                [ngClass]="{ 'expand': menu2.state == 'expand', 'closed': menu2.state == 'collapsed', 'has-sub': menu2.submenu, 'd-none': menu2.hide }"
                                #rla2="routerLinkActive">
                                @if (menu2.submenu) {
                                <a class="menu-link"
                                    (click)="(menu2.submenu) ? expandCollapseSubmenu(menu2, menu1.submenu, rla2) : ''">
                                    <ng-template
                                        *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu2}"></ng-template>
                                </a>
                                }
                                @if (!menu2.submenu) {
                                <a class="menu-link" [routerLink]="menu2.url">
                                    <ng-template
                                        *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu2}"></ng-template>
                                </a>
                                }

                                <!-- submenu lvl 3 -->
                                @if (menu2.submenu) {
                                <div class="menu-submenu"
                                    [style.display]="(menu2.state == 'expand' && !appSettings.appSidebarMinified) ? 'block' : (menu2.state == 'collapse') ? 'none' : ''">
                                    @for (menu3 of menu2.submenu; track menu3) {
                                    <div class="menu-item" routerLinkActive="active"
                                        [routerLinkActiveOptions]="{exact: true}"
                                        [ngClass]="{ 'expand': menu3.state == 'expand', 'closed': menu3.state == 'collapsed', 'has-sub': menu3.submenu, 'd-none': menu3.hide }"
                                        #rla3="routerLinkActive">
                                        @if (menu3.submenu) {
                                        <a class="menu-link"
                                            (click)="(menu3.submenu) ? expandCollapseSubmenu(menu3, menu2.submenu, rla3) : ''">
                                            <ng-template
                                                *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu3}"></ng-template>
                                        </a>
                                        }
                                        @if (!menu3.submenu) {
                                        <a class="menu-link" [routerLink]="menu3.url">
                                            <ng-template
                                                *ngTemplateOutlet="sidebarSubMenuNav; context: {menu: menu3}"></ng-template>
                                        </a>
                                        }
                                    </div>
                                    }
                                </div>
                                }
                            </div>
                            }
                        </div>
                        }
                    </div>
                    }
                </div>
                }
            </div>
            }

            <!-- BEGIN minify-button -->
            <div class="menu-item d-flex">
                <a href="javascript:;" class="app-sidebar-minify-btn ms-auto" (click)="toggleAppSidebarMinified()"><i
                        [class]="appSettings.appSidebarMinified ? 'fa fa-angle-double-right' : 'fa fa-angle-double-left'"></i></a>
            </div>
            <!-- END minify-button -->
        </div>
        <!-- END menu -->
    </ng-scrollbar>
    <!-- END scrollbar -->
</div>
<div class="app-sidebar-bg" [attr.data-bs-theme]="appSettings.appSidebarLight ? '' : 'dark'"></div>
<div class="app-sidebar-mobile-backdrop"><a href="javascript:;" (click)="toggleAppSidebarMobile()"
        class="stretched-link"></a></div>
		
<!-- END #sidebar -->

@if (appSettings.appSidebarMinified) {
<float-sub-menu [menus]="appSidebarFloatSubMenu" [top]="appSidebarFloatSubMenuTop" [left]="appSidebarFloatSubMenuLeft"
    [right]="appSidebarFloatSubMenuRight" [bottom]="appSidebarFloatSubMenuBottom"
    [arrowTop]="appSidebarFloatSubMenuArrowTop" [arrowBottom]="appSidebarFloatSubMenuArrowBottom"
    [lineTop]="appSidebarFloatSubMenuLineTop" [lineBottom]="appSidebarFloatSubMenuLineBottom"
    (remainAppSidebarFloatSubMenu)="remainAppSidebarFloatSubMenu()"
    (hideAppSidebarFloatSubMenu)="hideAppSidebarFloatSubMenu()"
    (calculateAppSidebarFloatSubMenuPosition)="calculateAppSidebarFloatSubMenuPosition()"></float-sub-menu>
}
}