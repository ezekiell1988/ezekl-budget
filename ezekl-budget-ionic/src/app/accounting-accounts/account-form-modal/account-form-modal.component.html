<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{ isEditMode ? 'Editar Cuenta Contable' : 'Nueva Cuenta Contable' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()" fill="clear" color="light">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="accountForm" (ngSubmit)="onSubmit()">
    <!-- Campo cuenta padre (solo para creación, o edición si es relevante) -->
    <ion-select
      formControlName="idAccountingAccountFather"
      label="Cuenta Padre"
      labelPlacement="floating"
      placeholder="Seleccione una cuenta padre (opcional)"
      interface="popover"
      [interfaceOptions]="{
        header: 'Seleccionar Cuenta Padre',
        subHeader: 'Deje vacío para crear una cuenta raíz'
      }"
      helperText="Cuenta padre para crear una subcuenta"
      [errorText]="getParentAccountErrorText()"
      class="ion-margin-bottom">
      <ion-select-option [value]="null">Sin cuenta padre (cuenta raíz)</ion-select-option>
      @for (account of availableParentAccounts; track account.idAccountingAccount) {
        <ion-select-option [value]="account.idAccountingAccount">
          {{ account.codeAccountingAccount }} - {{ account.nameAccountingAccount }}
        </ion-select-option>
      }
    </ion-select>

    <!-- Campo código -->
    <ion-input
      formControlName="codeAccountingAccount"
      label="Código de Cuenta"
      labelPlacement="floating"
      placeholder="Ingrese el código de la cuenta"
      maxlength="50"
      [clearInput]="true"
      helperText="Código único de identificación (ej: 001-001-001)"
      [errorText]="getCodeErrorText()"
      class="ion-margin-bottom">
    </ion-input>

    <!-- Campo nombre -->
    <ion-input
      formControlName="nameAccountingAccount"
      label="Nombre de la Cuenta"
      labelPlacement="floating"
      placeholder="Ingrese el nombre de la cuenta"
      maxlength="255"
      [clearInput]="true"
      helperText="Nombre descriptivo de la cuenta contable"
      [errorText]="getNameErrorText()"
      class="ion-margin-bottom">
    </ion-input>

    <!-- Información adicional si es edición -->
    @if (isEditMode && account) {
    <ion-card color="light" class="ion-margin-bottom">
      <ion-card-header>
        <ion-card-title>Información Actual</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="none">
          <ion-label>
            <h3>ID de la cuenta:</h3>
            <p>{{ account.idAccountingAccount }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <h3>Estado:</h3>
            <p>{{ account.active ? 'Activa' : 'Inactiva' }}</p>
          </ion-label>
        </ion-item>
        @if (account.children && account.children.length > 0) {
        <ion-item lines="none">
          <ion-label>
            <h3>Subcuentas:</h3>
            <p>{{ account.children.length }} cuenta(s) dependiente(s)</p>
          </ion-label>
        </ion-item>
        }
      </ion-card-content>
    </ion-card>
    }

    <!-- Botones de acción -->
    <div class="ion-margin-top" style="display: flex; flex-direction: column; gap: 12px; padding: 16px 0;">
      <ion-button
        expand="full"
        type="submit"
        [disabled]="accountForm.invalid || isLoading"
        color="primary">
        @if (isLoading) {
          <ion-spinner name="crescent" slot="start"></ion-spinner>
          {{ isEditMode ? 'Actualizando...' : 'Creando...' }}
        } @else {
          <ion-icon name="save-outline" slot="start"></ion-icon>
          {{ isEditMode ? 'Actualizar Cuenta' : 'Crear Cuenta' }}
        }
      </ion-button>

      <ion-button
        expand="full"
        fill="outline"
        color="medium"
        (click)="dismiss()"
        [disabled]="isLoading">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>
