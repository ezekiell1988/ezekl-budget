<app-header title="Cuentas Contables"></app-header>

<ion-content [fullscreen]="true">
  <!-- Refresher para pull-to-refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingText="Arrastra para actualizar..."
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <ion-grid fixed>
    <!-- Header condensado -->
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">Catálogo de Cuentas</ion-title>
      </ion-toolbar>
    </ion-header>

    <!-- Barra de búsqueda -->
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="onSearchChange($event)"
      (ionClear)="onSearchClear()"
      placeholder="Buscar cuentas contables..."
      debounce="500"
      show-clear-button="focus">
    </ion-searchbar>

    <!-- Información de resultados -->
    @if (pagination) {
      <div class="ion-padding-horizontal ion-padding-bottom">
        <ion-text color="medium">
          <small>
            Mostrando {{ accounts.length }} de {{ pagination.totalItems }} cuentas
            @if (searchTerm) {
              <span> • Búsqueda: "{{ searchTerm }}"</span>
            }
          </small>
        </ion-text>
      </div>
    }

    <!-- Lista de cuentas contables -->
    @if (!isInitialLoading) {
      <ion-list class="ion-no-padding">
        @for (account of accounts; track account.idAccountingAccount) {
          <ion-item button (click)="onAccountClick(account)" lines="full">
            <ion-label class="ion-text-wrap">
              <h2 class="ion-no-margin ion-margin-bottom">{{ account.nameAccountingAccount }}</h2>
              <p class="ion-no-margin">
                <ion-text color="primary">
                  <strong>{{ account.codeAccountingAccount }}</strong>
                </ion-text>
                <ion-text color="medium">
                  <small> • ID: {{ account.idAccountingAccount }}</small>
                </ion-text>
              </p>
            </ion-label>
          </ion-item>
        }
      </ion-list>
    }

    <!-- Skeleton loading para carga inicial -->
    @if (isInitialLoading) {
      <ion-list class="ion-no-padding">
        @for (item of skeletonItems; track $index) {
          <ion-item lines="full">
            <ion-label>
              <h2 class="ion-no-margin ion-margin-bottom">
                <ion-skeleton-text [animated]="true" style="width: 70%;"></ion-skeleton-text>
              </h2>
              <p class="ion-no-margin">
                <ion-skeleton-text [animated]="true" style="width: 40%;"></ion-skeleton-text>
              </p>
            </ion-label>
          </ion-item>
        }
      </ion-list>
    }

    <!-- Estado vacío -->
    @if (!isInitialLoading && accounts.length === 0 && !error) {
      <ion-card class="ion-no-margin ion-margin-top">
        <ion-card-content class="ion-text-center ion-padding">
          <ion-icon
            name="document-text-outline"
            color="medium"
            style="font-size: 4rem; margin-bottom: 1rem;">
          </ion-icon>
          <h2 class="ion-no-margin ion-margin-bottom">No se encontraron cuentas</h2>
          @if (searchTerm) {
            <p class="ion-text-wrap" style="color: var(--ion-color-medium); line-height: 1.5;">
              No hay cuentas que coincidan con "{{ searchTerm }}"
            </p>
          }
          @if (!searchTerm) {
            <p class="ion-text-wrap" style="color: var(--ion-color-medium); line-height: 1.5;">
              No hay cuentas contables disponibles
            </p>
          }
          <ion-button fill="clear" (click)="retryLoad()" class="ion-margin-top">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Reintentar
          </ion-button>
        </ion-card-content>
      </ion-card>
    }

    <!-- Estado de error -->
    @if (error) {
      <ion-card class="ion-no-margin ion-margin-top" color="danger">
        <ion-card-content class="ion-text-center ion-padding">
          <ion-icon
            name="alert-circle-outline"
            color="light"
            style="font-size: 4rem; margin-bottom: 1rem;">
          </ion-icon>
          <h2 class="ion-no-margin ion-margin-bottom" style="color: white;">Error al cargar cuentas</h2>
          <p class="ion-text-wrap" style="color: rgba(255, 255, 255, 0.8); line-height: 1.5;">
            {{ error }}
          </p>
          <ion-button fill="outline" color="light" (click)="retryLoad()" class="ion-margin-top">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Reintentar
          </ion-button>
        </ion-card-content>
      </ion-card>
    }

    <!-- Infinite scroll -->
    <ion-infinite-scroll
      threshold="100px"
      (ionInfinite)="loadMoreData($event)"
      [disabled]="!pagination?.hasNextPage || isLoading">
      <ion-infinite-scroll-content
        loadingText="Cargando más cuentas..."
        loadingSpinner="bubbles">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ion-grid>

</ion-content>
