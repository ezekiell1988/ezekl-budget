<app-header title="Cuentas Contables"></app-header>

<ion-content [fullscreen]="true">
  <!-- Refresher para pull-to-refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingText="Arrastra para actualizar..."
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <ion-grid fixed>
    <!-- Header condensado -->
        <ion-header collapse="condense">
          <ion-toolbar>
            <ion-title size="large">Catálogo de Cuentas</ion-title>
          </ion-toolbar>
        </ion-header>

        <!-- Barra de búsqueda -->
        <ion-searchbar
          [(ngModel)]="searchTerm"
          (ionInput)="onSearchChange($event)"
          (ionClear)="onSearchClear()"
          placeholder="Buscar cuentas contables..."
          debounce="500"
          show-clear-button="focus">
        </ion-searchbar>

        <!-- Información de resultados -->
        @if (pagination) {
          <div class="results-info">
            <ion-text color="medium">
              <small>
                Mostrando {{ accounts.length }} de {{ pagination.totalItems }} cuentas
                @if (searchTerm) {
                  <span> • Búsqueda: "{{ searchTerm }}"</span>
                }
              </small>
            </ion-text>
          </div>
        }

        <!-- Lista de cuentas contables -->
        @if (!isInitialLoading) {
          <ion-list>
            @for (account of accounts; track account.idAccountingAccount) {
              <ion-item
                button
                (click)="onAccountClick(account)">

                <ion-label>
                  <h3>{{ account.nameAccountingAccount }}</h3>
                  <p>
                    <ion-text color="primary">
                      <strong>{{ account.codeAccountingAccount }}</strong>
                    </ion-text>
                    <span class="account-id"> • ID: {{ account.idAccountingAccount }}</span>
                  </p>
                </ion-label>
              </ion-item>
            }
          </ion-list>
        }

        <!-- Skeleton loading para carga inicial -->
        @if (isInitialLoading) {
          <div class="skeleton-container">
            <ion-list>
              @for (item of skeletonItems; track $index) {
                <ion-item>
                  <ion-label>
                    <h3>
                      <ion-skeleton-text
                        [animated]="true"
                        style="width: 70%;">
                      </ion-skeleton-text>
                    </h3>
                    <p>
                      <ion-skeleton-text
                        [animated]="true"
                        style="width: 40%;">
                      </ion-skeleton-text>
                    </p>
                  </ion-label>
                </ion-item>
              }
            </ion-list>
          </div>
        }

        <!-- Estado vacío -->
        @if (!isInitialLoading && accounts.length === 0 && !error) {
          <div class="empty-state">
            <ion-icon
              name="document-text-outline"
              color="medium"
              size="large">
            </ion-icon>
            <h3>No se encontraron cuentas</h3>
            @if (searchTerm) {
              <p>
                No hay cuentas que coincidan con "{{ searchTerm }}"
              </p>
            }
            @if (!searchTerm) {
              <p>
                No hay cuentas contables disponibles
              </p>
            }
            <ion-button
              fill="clear"
              (click)="retryLoad()">
              <ion-icon name="refresh" slot="start"></ion-icon>
              Reintentar
            </ion-button>
          </div>
        }

        <!-- Estado de error -->
        @if (error) {
          <div class="error-state">
            <ion-icon
              name="alert-circle-outline"
              color="danger"
              size="large">
            </ion-icon>
            <h3>Error al cargar cuentas</h3>
            <p>{{ error }}</p>
            <ion-button
              fill="clear"
              color="danger"
              (click)="retryLoad()">
              <ion-icon name="refresh" slot="start"></ion-icon>
              Reintentar
            </ion-button>
          </div>
        }

        <!-- Infinite scroll -->
        <ion-infinite-scroll
          threshold="100px"
          (ionInfinite)="loadMoreData($event)"
          [disabled]="!pagination?.hasNextPage || isLoading">

          <ion-infinite-scroll-content
            loadingText="Cargando más cuentas..."
            loadingSpinner="bubbles">
          </ion-infinite-scroll-content>
        </ion-infinite-scroll>
  </ion-grid>

</ion-content>
