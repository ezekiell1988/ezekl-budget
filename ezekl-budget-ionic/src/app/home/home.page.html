<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Ezekl Budget - WebSocket Test
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">WebSocket Test</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container">
    <!-- Estado de conexiÃ³n WebSocket -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>ðŸ”Œ Estado WebSocket</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="connection-status">
          <ion-chip [color]="connectionStatus === 'connected' ? 'success' : connectionStatus === 'connecting' ? 'warning' : 'danger'">
            <ion-icon
              [name]="connectionStatus === 'connected' ? 'wifi' : connectionStatus === 'connecting' ? 'refresh' : 'cloud-offline'"
              class="status-icon">
            </ion-icon>
            <ion-label>{{ getStatusText() }}</ion-label>
          </ion-chip>
        </div>

        <p class="status-details">
          <strong>URL:</strong> {{ wsUrl }}<br>
          <strong>Intentos de reconexiÃ³n:</strong> {{ reconnectAttempts }}<br>
          <strong>Ãšltimo ping:</strong> {{ lastPing || 'Nunca' }}<br>
          <strong>Ãšltimo pong:</strong> {{ lastPong || 'Nunca' }}
        </p>
      </ion-card-content>
    </ion-card>

    <!-- Mensajes del WebSocket -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>ðŸ“¨ Mensajes</ion-card-title>
        <ion-card-subtitle>Ãšltimos 10 mensajes</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="messages-container" #messagesContainer>
          <div
            *ngFor="let message of messages; trackBy: trackByMessage"
            class="message-item"
            [ngClass]="'message-' + message.type">
            <div class="message-time">{{ formatTime(message.timestamp) }}</div>
            <div class="message-content">
              <strong>{{ message.type.toUpperCase() }}:</strong>
              {{ message.content }}
            </div>
          </div>
          <div *ngIf="messages.length === 0" class="no-messages">
            No hay mensajes aÃºn...
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Controles -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>ðŸŽ® Controles</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="controls">
          <ion-button
            expand="block"
            fill="outline"
            (click)="sendPing()"
            [disabled]="connectionStatus !== 'connected'">
            <ion-icon name="pulse" slot="start"></ion-icon>
            Enviar Ping Manual
          </ion-button>

          <ion-button
            expand="block"
            fill="outline"
            (click)="sendEcho()"
            [disabled]="connectionStatus !== 'connected'">
            <ion-icon name="chatbubble" slot="start"></ion-icon>
            Enviar Echo Test
          </ion-button>

          <ion-button
            expand="block"
            color="warning"
            fill="outline"
            (click)="reconnect()">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Reconectar
          </ion-button>

          <ion-button
            expand="block"
            color="danger"
            fill="outline"
            (click)="clearMessages()">
            <ion-icon name="trash" slot="start"></ion-icon>
            Limpiar Mensajes
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
