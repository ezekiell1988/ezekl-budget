<ion-menu contentId="main-content" menuId="main-menu" side="start" type="overlay">
  <ion-header>
    <ion-toolbar>
      <ion-title>Mi Perfil</ion-title>
      <ion-button slot="end" fill="clear" (click)="closeMenu()">
        <ion-icon name="close" slot="icon-only" size="large"></ion-icon>
      </ion-button>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <!-- Información del usuario -->
    @if (currentUser) {
    <ion-card>
      <ion-card-content>
        <div class="profile-header">
          <ion-avatar class="profile-avatar" color="primary">
            <div class="avatar-text">{{ getUserInitials(currentUser) }}</div>
          </ion-avatar>
          <div class="profile-info">
            <h2>{{ currentUser.nameLogin }}</h2>
            <p>{{ currentUser.codeLogin }}</p>
            <ion-chip color="success" size="small">
              <ion-icon name="checkmark-circle" slot="start"></ion-icon>
              <ion-label>Conectado</ion-label>
            </ion-chip>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Lista de información del usuario -->
    <ion-list>
      <ion-list-header>
        <ion-label>Información Personal</ion-label>
      </ion-list-header>

      @if (currentUser.emailLogin) {
      <ion-item>
        <ion-icon name="mail" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Email</h3>
          <p>{{ currentUser.emailLogin }}</p>
        </ion-label>
      </ion-item>
      }

      @if (currentUser.phoneLogin) {
      <ion-item>
        <ion-icon name="call" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Teléfono</h3>
          <p>{{ currentUser.phoneLogin }}</p>
        </ion-label>
      </ion-item>
      }

      <ion-item>
        <ion-icon name="card" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>ID Usuario</h3>
          <p>#{{ currentUser.idLogin }}</p>
        </ion-label>
      </ion-item>

      <!-- Información de sesión -->
      @if (authState$ | async; as authState) {
      <ion-item>
        <ion-icon name="time" slot="start" color="warning"></ion-icon>
        <ion-label>
          <h3>Token expira en</h3>
          <p>{{ formatTokenExpiry(authState.expiresAt) }}</p>
        </ion-label>
      </ion-item>
      }

      <!-- Botón de extensión de sesión -->
      <ion-item>
        <ion-button expand="block" fill="outline" color="success" (click)="extendSession()">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Extender Sesión
        </ion-button>
      </ion-item>
    </ion-list>
    }

    <!-- Menú dinámico de navegación -->
    @for (section of menuSections$ | async; track section.id) {
    <ion-list>
      <ion-list-header>
        <ion-label>{{ section.title }}</ion-label>
      </ion-list-header>

      @for (item of section.items; track item.id) {
      <ion-item
        button
        [disabled]="!item.enabled"
        (click)="onMenuItemClick(item)"
        [lines]="section.id === 'session' ? 'none' : 'inset'">
        <ion-icon
          [name]="item.icon"
          slot="start"
          [color]="item.color || 'primary'">
        </ion-icon>
        <ion-label [color]="item.enabled ? '' : 'medium'">
          {{ item.title }}
        </ion-label>
        @if (item.badge) {
        <ion-badge [color]="item.badge.color" slot="end">
          {{ item.badge.text }}
        </ion-badge>
        }
      </ion-item>
      }
    </ion-list>
    }
  </ion-content>
</ion-menu>
