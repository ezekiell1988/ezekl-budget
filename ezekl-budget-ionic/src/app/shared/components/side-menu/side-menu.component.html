<ion-menu
  contentId="main-content"
  menuId="main-menu"
  side="start"
  type="overlay"
  role="navigation"
  aria-label="Menú lateral de navegación"
  class="side-menu">
  <ion-header>
    <ion-toolbar>
      <ion-title>Mi Perfil</ion-title>
      <ion-button
        slot="end"
        fill="clear"
        (click)="closeMenu()"
        aria-label="Cerrar menú lateral"
        class="close-menu-button">
        <ion-icon name="close" slot="icon-only" size="large" aria-hidden="true"></ion-icon>
      </ion-button>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <!-- Información del usuario -->
    @if (currentUser) {
    <ion-card class="profile-card" color="light">
      <ion-card-content class="ion-no-padding">
        <ion-item lines="none" class="profile-item">
          <ion-avatar slot="start" class="profile-avatar">
            <div class="avatar-text">{{ getUserInitials(currentUser) }}</div>
          </ion-avatar>
          <ion-label>
            <h2 class="profile-name">{{ currentUser.nameLogin }}</h2>
            <p class="profile-code">{{ currentUser.codeLogin }}</p>
            <ion-chip color="success" size="small" class="profile-status">
              <ion-icon name="checkmark-circle" slot="start"></ion-icon>
              <ion-label>Conectado</ion-label>
            </ion-chip>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Lista de información del usuario -->
    <ion-list inset="true">
      <ion-list-header>
        <ion-icon name="person" slot="start" color="primary"></ion-icon>
        <ion-label>Información Personal</ion-label>
      </ion-list-header>

      @if (currentUser.emailLogin) {
      <ion-item button="false" lines="inset">
        <ion-icon name="mail" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Email</h3>
          <p>{{ currentUser.emailLogin }}</p>
        </ion-label>
      </ion-item>
      }

      @if (currentUser.phoneLogin) {
      <ion-item button="false" lines="inset">
        <ion-icon name="call" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Teléfono</h3>
          <p>{{ currentUser.phoneLogin }}</p>
        </ion-label>
      </ion-item>
      }

      <ion-item button="false" lines="inset">
        <ion-icon name="card" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>ID Usuario</h3>
          <p>#{{ currentUser.idLogin }}</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Información de sesión -->
    @if (authState$ | async; as authState) {
    <ion-list inset="true">
      <ion-list-header>
        <ion-icon name="time" slot="start" color="warning"></ion-icon>
        <ion-label>Sesión Activa</ion-label>
      </ion-list-header>

      <ion-item button="false" lines="none">
        <ion-icon name="pulse" slot="start" color="warning"></ion-icon>
        <ion-label>
          <h3>Token expira en</h3>
          <p>{{ formatTokenExpiry(authState.expiresAt) }}</p>
        </ion-label>
        <ion-badge color="warning" slot="end">Auto</ion-badge>
      </ion-item>

      <!-- Botón de extensión de sesión -->
      <ion-item lines="none">
        <ion-button expand="block" fill="outline" color="success" (click)="extendSession()">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Extender Sesión
        </ion-button>
      </ion-item>
    </ion-list>
    }
    }

    <!-- Menú dinámico de navegación -->
    @for (section of menuSections$ | async; track section.id) {
    <ion-list inset="true" class="menu-section">
      <ion-list-header>
        <ion-icon name="apps" slot="start" color="medium"></ion-icon>
        <ion-label>{{ section.title }}</ion-label>
      </ion-list-header>

      @for (item of section.items; track item.id) {
      <ion-item
        button
        [disabled]="!item.enabled"
        (click)="onMenuItemClick(item, $event)"
        [lines]="section.id === 'session' ? 'none' : 'inset'"
        class="menu-item"
        [class.menu-item-disabled]="!item.enabled"
        [attr.aria-label]="item.title + (item.enabled ? '' : ' - No disponible')"
        role="menuitem"
        [tabindex]="item.enabled ? 0 : -1">
        <ion-icon
          [name]="item.icon"
          slot="start"
          [color]="item.enabled ? (item.color || 'primary') : 'medium'"
          aria-hidden="true">
        </ion-icon>
        <ion-label [color]="item.enabled ? '' : 'medium'">
          <h3 class="menu-item-title">{{ item.title }}</h3>
        </ion-label>
        @if (item.badge) {
        <ion-badge [color]="item.badge.color" slot="end" size="small" [attr.aria-label]="'Insignia: ' + item.badge.text">
          {{ item.badge.text }}
        </ion-badge>
        }
        @if (item.enabled) {
        <ion-icon name="chevron-forward" slot="end" color="medium" size="small" aria-hidden="true"></ion-icon>
        }
      </ion-item>
      }
    </ion-list>
    }
  </ion-content>
</ion-menu>
